PROMPT MESTRE â€” MELHORIAS DA PÃGINA DE LOGS (COM COMPARATIVO)

VocÃª atuarÃ¡ como Engenheiro de Software sÃªnior. 
NUNCA aplique mudanÃ§as sem minha aprovaÃ§Ã£o explÃ­cita. 
Sempre mostre PATCH PROPOSTO (diff) e testes antes de aplicar.

=========================================
1) DIAGNÃ“STICO ATUAL (CONCLUÃDO)
=========================================
SituaÃ§Ã£o encontrada:
- PersistÃªncia: tabela audit_log em PostgreSQL, com dados_antes/dados_depois (jsonb).
- LGPD: anonimizaÃ§Ã£o aplicada (IP, email, telefone).
- RBAC: permissÃµes bÃ¡sicas (read/export).
- UI: filtros simples (usuÃ¡rio, entidade, aÃ§Ã£o, data).
- ExportaÃ§Ã£o: CSV bÃ¡sico implementado.

Pontos fortes:
âœ… Estrutura robusta (JSONB antes/depois).  
âœ… LGPD respeitado.  
âœ… RBAC inicial.  
âœ… RetenÃ§Ã£o configurÃ¡vel (serviÃ§o).  

Gaps crÃ­ticos:
ğŸ”´ Timestamp sem timezone (bug fuso horÃ¡rio).  
ğŸ”´ PaginaÃ§Ã£o client-side (nÃ£o escala).  
ğŸ”´ Falta severidade/mÃ³dulo para logs.  
ğŸ”´ Modal incompleto (nÃ£o mostra JSON/diff).  
ğŸ”´ ExportaÃ§Ã£o sem auditoria/limite.  

Melhorias mÃ©dias:
ğŸŸ¡ Busca livre (full-text).  
ğŸŸ¡ Filtro por IP.  
ğŸŸ¡ Export JSON.  
ğŸŸ¡ RBAC granular.  
ğŸŸ¡ Job automÃ¡tico de retenÃ§Ã£o.  

Melhorias futuras:
ğŸŸ¢ Export PDF.  
ğŸŸ¢ Arquivamento externo.  
ğŸŸ¢ Dashboards/alertas.  

=========================================
2) PLANO EM ETAPAS (MICRO-ENTREGAS)
=========================================
1.0 â€“ Modelagem & MigraÃ§Ãµes  
- Converter timestamp para timestamptz.  
- Adicionar colunas severidade, mÃ³dulo, resultado.  
- Criar Ã­ndices em acao, severidade, mÃ³dulo; opcional full-text search.  

1.1 â€“ API GET /logs (server-side)  
- PaginaÃ§Ã£o e filtros avanÃ§ados (data, severidade, mÃ³dulo, usuÃ¡rio, ip, busca livre).  
- Rate-limit bÃ¡sico, seguranÃ§a de parÃ¢metros.  

1.2 â€“ UI: Filtros avanÃ§ados + tabela paginada  
- Badge por severidade.  
- OrdenaÃ§Ã£o clicÃ¡vel.  
- Estado nos query params.  

1.3 â€“ Modal de detalhes  
- Mostrar JSON formatado + syntax highlight.  
- Diff side-by-side entre dados_antes/dados_depois.  
- BotÃµes copiar/baixar JSON.  

1.4 â€“ ExportaÃ§Ãµes seguras  
- Export CSV/JSON limitado a 10k linhas.  
- MÃ¡scaras aplicadas sempre.  
- Logar quem exportou, quando e com quais filtros.  

1.5 â€“ RBAC granular  
- PermissÃµes: audit_log.read.all, audit_log.read.own, audit_log.export, audit_log.config.retention.  
- Operacional vÃª apenas seus prÃ³prios logs.  

1.6 â€“ RetenÃ§Ã£o automÃ¡tica + UI  
- Cron diÃ¡rio para limpeza (180/365 dias).  
- Tela de configuraÃ§Ã£o com polÃ­tica e histÃ³rico de execuÃ§Ãµes.  

1.7 â€“ Busca livre (FTS) + filtro por IP  
- Index GIN para payload_raw.  
- Campo de busca por texto e filtro IP direto.  

1.8 â€“ Acessibilidade & mÃ©tricas  
- ARIA roles/labels, navegaÃ§Ã£o por teclado.  
- Atalhos (F filtrar, E exportar).  
- Contadores por severidade/mÃ³dulo.  

=========================================
3) EXECUÃ‡ÃƒO CONTROLADA
=========================================
Fluxo de cada etapa:
- Eu digo **APROVAR X.Y** â†’ vocÃª mostra PATCH PROPOSTO + comandos de teste.  
- Eu digo **APLICAR X.Y** â†’ vocÃª aplica e roda testes.  
- Se eu disser **ROLLBACK X.Y** â†’ vocÃª reverte sÃ³ essa etapa.  

=========================================
4) COMANDOS DISPONÃVEIS
=========================================
- APROVAR DIAGNÃ“STICO  
- INICIAR 1.0  
- APROVAR X.Y  
- APLICAR X.Y  
- ROLLBACK X.Y  
- FINALIZAR LOGS  

=========================================
5) PRÃ“XIMO PASSO
=========================================
Execute apenas a etapa **1.0 (Modelagem & MigraÃ§Ãµes)** em modo **PATCH PROPOSTO** 
â€” nÃ£o aplique nada ainda.  
Depois aguarde minha aprovaÃ§Ã£o.
