PROMPT – DASHBOARD POR CORES E MÉTRICAS (EXECUÇÃO SOMENTE COM APROVAÇÃO)

Você atuará como Engenheiro de Software sênior neste repositório. 
NUNCA escreva nada sem minha aprovação explícita. 
Para cada etapa, gere primeiro o **PATCH PROPOSTO (diff)** + **comandos de teste**. 
Aguarde eu responder **APLICAR X.Y** para então aplicar.

========================
1) OBJETIVO VISUAL & REGRAS
========================
Padronizar a gestão visual do dashboard e as métricas de cada card:

PALETA PADRÃO (manter ícones como estão):
- Azul (#0d6efd): **Profissional Renner**
- Verde (#198754): **Visitante**
- Amarelo (#ffc107): **Prestador de Serviço**
- Vermelho (#dc3545): **Totais (soma de todos)**

MÉTRICAS POR CARD (cada card mostra 2 números):
- **Azul/Profissional Renner**
  - A1: **Ativos agora** (registros com HoraSaida FINAL nula – incluir remanescentes de dias anteriores)
  - A2: **Registrados HOJE** (contagem de entradas criadas hoje no fuso America/Sao_Paulo)
- **Verde/Visitante**
  - V1: **Ativos agora**
  - V2: **Registrados HOJE**
- **Amarelo/Prestador de Serviço**
  - P1: **Ativos agora**
  - P2: **Registrados HOJE**
- **Vermelho/Total**
  - T1: **Ativos agora (A1+V1+P1)**
  - T2: **Registrados HOJE (A2+V2+P2)**

REGRA ESPECIAL (“carregar ativos do dia anterior”):
- “Ativos agora” **NÃO reseta**: é **todo registro** do tipo cujo **HoraSaida FINAL esteja nula**, independente do dia de entrada.
- “Registrados HOJE” **reseta diariamente** (zero no dia seguinte), **mas** se existir alguém ainda ativo do dia anterior **ele não entra na contagem de “Registrados HOJE”**; ele aparece apenas em “Ativos agora” (e continua na lista do dashboard).  
  *Exemplo*: Entraram 100 pessoas ontem e 99 saíram → hoje “Registrados HOJE” pode ser 0, mas “Ativos agora” mostra 1 até dar baixa.

Timezone de referência: **America/Sao_Paulo**.

========================
2) PLANO EM ETAPAS (MICRO-ENTREGAS)
========================
Gere o plano abaixo e AGUARDE minha autorização por etapa.

--- ETAPA 1.0 – Diagnóstico & Contratos de Consulta (SEM APLICAR) ---
Objetivo:
- Mapear onde os cards são renderizados (template/view) e onde as contagens são calculadas (serviço/DAO).
- Confirmar nomes das colunas/flags: Tipo (`profissional_renner`, `visitante`, `prestador`), `data_hora_entrada`, `hora_saida` (final).
- Definir contratos de função para:
  - `countAtivosAgora(tipo)`
  - `countRegistradosHoje(tipo, tz='America/Sao_Paulo')`
Saída:
- Relatório dos arquivos/rotas afetados.
- Pseudo-SQL/ORM de cada contagem (ver abaixo).
PERGUNTE: **“APROVAR 1.0?”**

Pseudo-SQL sugerido:
- **Ativos agora (por tipo)**  
  `SELECT COUNT(*) FROM registros WHERE tipo = :tipo AND hora_saida IS NULL;`
- **Registrados HOJE (por tipo)**  
  `SELECT COUNT(*) FROM registros WHERE tipo = :tipo AND data_hora_entrada >= :inicioHoje AND data_hora_entrada < :inicioAmanha;`  
  Onde `inicioHoje`/`inicioAmanha` são calculados em **America/Sao_Paulo**.

--- ETAPA 1.1 – Azul (Profissional Renner): UI + cores + métricas (DRY-RUN) ---
Objetivo:
- Aplicar cor **Azul** no card “Profissional Renner”.
- Exibir dois contadores: **A1 (Ativos agora)** e **A2 (Registrados HOJE)**.
- Manter o **ícone atual**.
Mudanças propostas:
- Refatorar componente do card para receber `{title, primaryCount, secondaryCount, color, icon}`.
- Chamar `countAtivosAgora('profissional_renner')` e `countRegistradosHoje('profissional_renner')`.
DoD:
- Card azul, título correto, ícone preservado, números corretos.
Teste manual:
- Criar 2 entradas Renner hoje → A2 aumenta.
- Deixar 1 Renner sem `hora_saida` de ontem → A1 inclui esse 1.
PERGUNTE: **“APROVAR PATCH 1.1?”** (não aplicar ainda)

--- ETAPA 1.2 – Verde (Visitante): UI + métricas (DRY-RUN) ---
- Mesma lógica da 1.1 usando `visitante`.
- DoD/testes equivalentes.
PERGUNTE: **“APROVAR PATCH 1.2?”**

--- ETAPA 1.3 – Amarelo (Prestador de Serviço): UI + métricas (DRY-RUN) ---
- Mesma lógica da 1.1 usando `prestador`.
PERGUNTE: **“APROVAR PATCH 1.3?”**

--- ETAPA 1.4 – Vermelho (Totais): UI + agregação (DRY-RUN) ---
Objetivo:
- Card vermelho com:
  - **T1 = A1 + V1 + P1** (Ativos agora somados)
  - **T2 = A2 + V2 + P2** (Registrados HOJE somados)
DoD:
- Soma correta; ícone atual preservado.
PERGUNTE: **“APROVAR PATCH 1.4?”**

--- ETAPA 1.5 – Aplicação incremental + QA visual ---
- Aplicar patches aprovados (1.1 → 1.4) em branch `feat/dashboard-cores-metricas`.
- Rodar linters/build.
- Capturar prints antes/depois.
- Smoke test nos 4 cards.
PERGUNTE: **“FINALIZAR 1.5?”** (aplica apenas se eu autorizar)

--- ETAPA 1.6 – Garantias de consistência & testes automatizados (opcional) ---
- Testes de serviço para `countAtivosAgora` e `countRegistradosHoje`.
- Teste de “virada do dia” simulando timezone **America/Sao_Paulo**.
- Proteções anti N+1 queries.
PERGUNTE: **“APROVAR 1.6?”**

========================
3) PATCH PROPOSTO – FORMATO EXIGIDO
========================
Para cada etapa (1.1–1.4), gere **apenas o PATCH PROPOSTO** com:
- Arquivos alterados/novos.
- Blocos de código completos (componentes, serviços, consultas).
- Onde e como obtém `inicioHoje`/`inicioAmanha` respeitando **America/Sao_Paulo**.
- Como mantém os **ícones atuais**.
- Comandos de teste (seed rápido + chamadas às funções).
Aguarde minha resposta **APLICAR X.Y** para escrever de fato.

========================
4) REGRAS & SALVAGUARDAS
========================
- NUNCA aplicar mudanças sem eu escrever: **APLICAR <etapa>**.
- Todas as contagens devem ignorar *saída intermediária/retorno*; só “Hora de Saída FINAL” retira dos “Ativos agora”.
- Não alterar outras partes do layout. Apenas cards e suas métricas/cores.
- As funções de contagem devem ser reutilizáveis (sem duplicar regra por card).
- Considerar registros anulados/cancelados (se houver flag) para não contaminar contagens.

========================
5) COMANDOS QUE USAREI
========================
- **APROVAR 1.0 / 1.1 / 1.2 / 1.3 / 1.4 / 1.5 / 1.6**
- **APLICAR 1.1 / 1.2 / 1.3 / 1.4 / 1.5 / 1.6**
- **CORRIGIR PATCH <etapa>**
- **ROLLBACK <etapa>**
- **FINALIZAR DASHBOARD**

>>> Comece pela **ETAPA 1.0 (Diagnóstico & Contratos de Consulta)** apenas em modo relatório (sem patch). Aguarde **APROVAR 1.0**.
