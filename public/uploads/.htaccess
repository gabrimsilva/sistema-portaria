# üö® BLOQUEIO TOTAL DE ACESSO DIRETO A DADOS BIOM√âTRICOS üö®
# Este arquivo .htaccess impede qualquer acesso direto a fotos/arquivos biom√©tricos
# conforme exigido pela LGPD para prote√ß√£o de dados sens√≠veis

# ‚úÖ EXCE√á√ÉO: Permitir acesso a fotos de profissionais (n√£o s√£o dados biom√©tricos sens√≠veis)
# üîí BLOQUEAR path traversal (.., %2e%2e, %5c, etc) para prevenir bypass de seguran√ßa
SetEnvIf Request_URI "\.\." path_traversal_detected
SetEnvIf Request_URI "%2[eE]" path_traversal_detected
SetEnvIf Request_URI "%5[cC]" path_traversal_detected
SetEnvIf Request_URI "^/uploads/profissionais/[^/]+\.(jpg|jpeg|png|gif|webp)$" allow_profissionais

# ‚ùå NEGAR ACESSO A TODOS OS ARQUIVOS NESTE DIRET√ìRIO (exceto profissionais)
Order deny,allow
Deny from all
Deny from env=path_traversal_detected
Allow from env=allow_profissionais

# ‚ùå Bloquear execu√ß√£o de qualquer script
<FilesMatch "\.(php|phtml|pl|py|jsp|asp|sh|cgi|js|html|htm)$">
    Order deny,allow
    Deny from all
</FilesMatch>

# ‚ùå Bloquear acesso a TODAS as imagens (prote√ß√£o cr√≠tica)
# ‚úÖ Exceto imagens em /profissionais/ (fotos corporativas p√∫blicas)
<FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|bmp|tiff|raw|psd|ico)$">
    Order deny,allow
    Deny from all
    Deny from env=path_traversal_detected
    Allow from env=allow_profissionais
</FilesMatch>

# ‚ùå N√£o permitir listagem de diret√≥rio
Options -Indexes -ExecCGI -FollowSymLinks

# ‚ùå Bloquear tamb√©m arquivos de configura√ß√£o
<FilesMatch "\.(htaccess|htpasswd|ini|conf|log|xml|json)$">
    Order deny,allow
    Deny from all
</FilesMatch>

# üìã Mensagens de erro personalizadas
ErrorDocument 403 "üö´ ACESSO NEGADO: Dados biom√©tricos protegidos pela LGPD. Use o sistema oficial para visualiza√ß√£o segura."
ErrorDocument 404 "‚ùå Arquivo n√£o encontrado"
ErrorDocument 401 "üîí N√£o autorizado"

# üõ°Ô∏è Headers de seguran√ßa m√°xima
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer"
    Header always set Cache-Control "no-cache, no-store, must-revalidate"
    Header always set Pragma "no-cache"
    Header always set Expires "0"
    Header always set Content-Security-Policy "default-src 'none'"
</IfModule>

# üîê Bloquear m√©todos HTTP n√£o necess√°rios
<LimitExcept GET>
    Order deny,allow
    Deny from all
</LimitExcept>

# ‚ö†Ô∏è AVISO CR√çTICO PARA DESENVOLVEDORES ‚ö†Ô∏è
# 
# Este diret√≥rio cont√©m dados biom√©tricos sens√≠veis protegidos pela LGPD:
# 
# ‚úÖ ACESSO CORRETO:
#    - Use o endpoint /secure/biometric/photo?id=X&token=Y
#    - Autentica√ß√£o obrigat√≥ria via sess√£o
#    - Token de acesso tempor√°rio necess√°rio
#    - Logs de auditoria autom√°ticos
# 
# ‚ùå NUNCA PERMITIR:
#    - Acesso direto via URL (ex: /uploads/employees/foto.jpg)
#    - Links p√∫blicos ou compartilh√°veis
#    - Cache de imagens no navegador
#    - Download direto sem autentica√ß√£o
# 
# üîß MIGRA√á√ÉO NECESS√ÅRIA:
#    - Execute /secure/biometric/migrate para mover arquivos
#    - Atualize controllers para usar SecureBiometricController
#    - Remova refer√™ncias diretas aos arquivos
# 
# üìã CONFORMIDADE LGPD:
#    - Art. 46: Seguran√ßa adequada para dados sens√≠veis
#    - Art. 49: Criptografia e controle de acesso
#    - Art. 11: Prote√ß√£o especial para dados biom√©tricos