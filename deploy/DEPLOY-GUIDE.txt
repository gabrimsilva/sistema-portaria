ğŸš€ GUIA COMPLETO DE DEPLOY VIA GITHUB ACTIONS
==============================================

Este guia configura deploy automÃ¡tico: GitHub push â†’ Build Docker â†’ Deploy Ubuntu

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ PRÃ‰-REQUISITOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âœ… Conta no Docker Hub (https://hub.docker.com)
2. âœ… RepositÃ³rio no GitHub
3. âœ… Servidor Ubuntu 24.04 com acesso SSH
4. âœ… Docker instalado no servidor

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PARTE 1: CONFIGURAR DOCKER HUB
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Acesse: https://hub.docker.com
2. VÃ¡ em Account Settings â†’ Security â†’ New Access Token
3. Nome: "GitHub Actions Deploy"
4. Permissions: Read & Write
5. Copie o token gerado (sÃ³ aparece uma vez!)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PARTE 2: CONFIGURAR SERVIDOR UBUNTU
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Conecte no servidor via SSH:
   ssh root@SEU-IP-SERVIDOR

2. Execute o script de configuraÃ§Ã£o:
   bash setup-server.sh

3. O script vai:
   âœ… Instalar Docker
   âœ… Criar usuÃ¡rio deployuser
   âœ… Gerar chave SSH
   âœ… Mostrar chave privada para copiar

4. COPIE A CHAVE PRIVADA exibida no final!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PARTE 3: CONFIGURAR GITHUB SECRETS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Acesse seu repositÃ³rio no GitHub
2. VÃ¡ em: Settings â†’ Secrets and variables â†’ Actions
3. Clique em "New repository secret"
4. Adicione estes 5 secrets:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nome do Secret   â”‚ Valor                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DOCKER_USERNAME  â”‚ Seu usuÃ¡rio do Docker Hub          â”‚
â”‚ DOCKER_PASSWORD  â”‚ Token gerado na Parte 1            â”‚
â”‚ SERVER_HOST      â”‚ IP do servidor (ex: 203.0.113.45)  â”‚
â”‚ SERVER_USER      â”‚ deployuser                         â”‚
â”‚ SSH_PRIVATE_KEY  â”‚ Chave privada da Parte 2           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IMPORTANTE: Cole a chave SSH COMPLETA incluindo:
-----BEGIN OPENSSH PRIVATE KEY-----
(conteÃºdo)
-----END OPENSSH PRIVATE KEY-----

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PARTE 4: CONFIGURAR SERVIDOR PARA PRIMEIRO DEPLOY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Conecte como deployuser:
   ssh deployuser@SEU-IP-SERVIDOR

2. Criar estrutura:
   cd ~/controle-portaria
   mkdir -p storage uploads logs docker

3. Copie os arquivos de configuraÃ§Ã£o:
   # Na sua mÃ¡quina local:
   scp deploy/docker-compose.prod.yml deployuser@SEU-IP:/home/deployuser/controle-portaria/docker-compose.yml
   scp deploy/.env.example deployuser@SEU-IP:/home/deployuser/controle-portaria/.env
   scp docker/init.sql deployuser@SEU-IP:/home/deployuser/controle-portaria/docker/
   scp docker/seed.sql deployuser@SEU-IP:/home/deployuser/controle-portaria/docker/

4. Edite o .env no servidor:
   nano .env
   
   Configure:
   - DOCKER_USERNAME (seu usuÃ¡rio Docker Hub)
   - DB_PASSWORD (senha segura)
   - SESSION_SECRET (chave aleatÃ³ria)

5. Inicie o banco de dados:
   docker-compose up -d db
   
   Aguarde ~30 segundos e verifique:
   docker-compose logs db

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PARTE 5: FAZER PRIMEIRO DEPLOY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Na sua mÃ¡quina local, faÃ§a push para GitHub:
   git add .
   git commit -m "Setup GitHub Actions deploy"
   git push origin main

2. Acompanhe o deploy:
   - Acesse GitHub â†’ seu repositÃ³rio â†’ Actions
   - Clique no workflow "Deploy Controle de Portaria"
   - Veja os logs em tempo real

3. ApÃ³s ~5 minutos:
   âœ… Build completo
   âœ… Push para Docker Hub
   âœ… Deploy no servidor
   âœ… AplicaÃ§Ã£o rodando!

4. Acesse:
   http://SEU-IP-SERVIDOR:8080

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ WORKFLOW AUTOMÃTICO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Agora toda vez que vocÃª fizer push:

1. âœ… GitHub Actions detecta push
2. âœ… ConstrÃ³i imagem Docker
3. âœ… Testa sintaxe PHP
4. âœ… Envia para Docker Hub
5. âœ… Conecta no servidor via SSH
6. âœ… Baixa nova versÃ£o
7. âœ… Reinicia aplicaÃ§Ã£o
8. âœ… Verifica se estÃ¡ funcionando

Tempo total: ~5 minutos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” COMANDOS ÃšTEIS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Ver logs da aplicaÃ§Ã£o
docker-compose logs -f app

# Ver status dos containers
docker-compose ps

# Reiniciar aplicaÃ§Ã£o
docker-compose restart app

# Ver logs de erro
docker-compose logs app | grep -i error

# Fazer backup do banco
docker exec controle-portaria-db-1 pg_dump -U postgres controle_portaria > backup.sql

# ForÃ§ar novo deploy manual
cd ~/controle-portaria
docker-compose pull app
docker-compose up -d --force-recreate app

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Problema: GitHub Actions falha no SSH
â†’ Verifique se a chave SSH estÃ¡ correta no secret
â†’ Teste SSH manualmente: ssh deployuser@SEU-IP

Problema: Docker pull falha
â†’ Verifique DOCKER_USERNAME e DOCKER_PASSWORD
â†’ Teste login: docker login

Problema: Container nÃ£o inicia
â†’ Veja logs: docker-compose logs app
â†’ Verifique .env estÃ¡ configurado
â†’ Verifique DATABASE_URL estÃ¡ correto

Problema: AplicaÃ§Ã£o nÃ£o responde
â†’ Verifique porta: docker-compose ps
â†’ Verifique firewall: sudo ufw status
â†’ Libere porta: sudo ufw allow 8080/tcp

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CHECKLIST FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¡ Token Docker Hub gerado
â–¡ Servidor Ubuntu configurado (setup-server.sh executado)
â–¡ 5 secrets configurados no GitHub
â–¡ docker-compose.yml e .env no servidor
â–¡ Banco de dados inicializado (docker-compose up -d db)
â–¡ Primeiro push feito
â–¡ AplicaÃ§Ã£o acessÃ­vel em http://SEU-IP:8080

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ PRONTO! Deploy automÃ¡tico configurado!
